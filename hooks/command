#!/bin/bash
set -euo pipefail

RESOLVED_HEAD=$(git -C $BUILDKITE_BUILD_CHECKOUT_PATH rev-parse HEAD)
RESOLVED_BUILDKITE_COMMIT=$(git -C $BUILDKITE_BUILD_CHECKOUT_PATH rev-parse $BUILDKITE_COMMIT)

echo "Parsed the current HEAD as ${RESOLVED_HEAD}"
echo "Parsed the current BUILDKITE_COMMIT as ${RESOLVED_BUILDKITE_COMMIT}" 

RESOLVED_HEAD_STRICT=$(git -C $BUILDKITE_BUILD_CHECKOUT_PATH rev-parse --verify HEAD)
echo "Parsed the current HEAD with --verify $RESOLVED_HEAD_STRICT"

RESOLVED_BUILDKITE_COMMIT_STRICT=$(git -C $BUILDKITE_BUILD_CHECKOUT_PATH rev-parse --verify $BUILDKITE_COMMIT)
echo "Parsed the current BUILDKITE_COMMIT with --verify $RESOLVED_BUILDKITE_COMMIT_STRICT"

TOP_LEVEL_PATH=$(git -C $BUILDKITE_BUILD_CHECKOUT_PATH rev-parse --show-toplevel)
echo "Top level path: $TOP_LEVEL_PATH"